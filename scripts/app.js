var Event=function(){"use strict";this.attach=function(e,a,t,o){var n="",l=void 0===o?!0:o,i=null;return void 0===window.addEventListener?(n="on"+e,i=function(e,t){return a.attachEvent(e,t),t}):(n=e,i=function(e,t,o){return a.addEventListener(e,t,o),t}),i.apply(a,[n,function(e){var a=e||event,o=a.srcElement||a.target;t(a,o)},l])},this.detach=function(e,a,t,o){var n="",l=void 0===o?!0:o;void 0===window.removeEventListener?(n="on"+e,a.detachEvent(n,t)):(n=e,a.removeEventListener(n,t,l))},this.stop=function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},this.prevent=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}},Magnifier=function(e,a){"use strict";var t=a||{},o=null,n={x:0,y:0,w:0,h:0,lensW:0,lensH:0,lensBgX:0,lensBgY:0,largeW:0,largeH:0,largeL:0,largeT:0,zoom:2,mode:"outside",largeWrapperId:void 0!==t.largeWrapper?t.largeWrapper.id||null:null,status:0,zoomAttached:!1,zoomable:void 0!==t.zoomable?t.zoomable:!1,onthumbenter:void 0!==t.onthumbenter?t.onthumbenter:null,onthumbmove:void 0!==t.onthumbmove?t.onthumbmove:null,onthumbleave:void 0!==t.onthumbleave?t.onthumbleave:null,onzoom:void 0!==t.onzoom?t.onzoom:null},l={t:0,l:0,x:0,y:0},i=0,r=0,m="",s=null,d=null,u=void 0!==t.zoom?t.zoom:n.zoom,c=t.mode||n.mode,g={},h=!1,p=0,f=function(e){var a=[],t=null,o=0,n="",l=0,i=0;if(document.getElementsByClassName)a=document.getElementsByClassName(e);else for(t=document.getElementsByTagName("*"),o=t.length,n=new RegExp("(^|\\s)"+e+"(\\s|$)"),i;o>l;l+=1)n.test(t[l].className)&&(a[i]=t[l],i+=1);return a},v=function(e){var a="",t=e.charAt(0),o=null;if(("#"===t||"."===t)&&(a=e.substr(1,e.length)),""!==a)switch(t){case"#":o=document.getElementById(a);break;case".":o=f(a)}return o},b=function(e,a){var t=document.createElement("div");t.id=a+"-lens",t.className="magnifier-loader",e.parentNode.appendChild(t)},y=function(){s.style.left=l.l+"px",s.style.top=l.t+"px",s.style.width=n.lensW+"px",s.style.height=n.lensH+"px",s.style.backgroundPosition="-"+n.lensBgX+"px -"+n.lensBgY+"px",d.style.left="-"+n.largeL+"px",d.style.top="-"+n.largeT+"px",d.style.width=n.largeW+"px",d.style.height=n.largeH+"px"},w=function(e,a,t,o){var n=v("#"+e+"-lens"),l=null;1===g[e].status?(l=document.createElement("div"),l.className="magnifier-loader-text",n.className="magnifier-loader hidden",l.appendChild(document.createTextNode("Loading...")),n.appendChild(l)):2===g[e].status&&(n.className="magnifier-lens hidden",n.removeChild(n.childNodes[0]),n.style.background="url("+a.src+") no-repeat 0 0 scroll",t.id=e+"-large",t.style.width=g[e].largeW+"px",t.style.height=g[e].largeH+"px",t.className="magnifier-large hidden","inside"===g[e].mode?n.appendChild(t):o.appendChild(t)),n.style.width=g[e].lensW+"px",n.style.height=g[e].lensH+"px"},z=function(){var e=l.x-n.x,a=l.y-n.y,t=0,o=0;h=0>e||0>a||e>n.w||a>n.h?!1:!0,o=e-n.lensW/2,t=a-n.lensH/2,"inside"!==n.mode&&(e<n.lensW/2&&(o=0),a<n.lensH/2&&(t=0),e-n.w+n.lensW/2>0&&(o=n.w-(n.lensW+2)),a-n.h+n.lensH/2>0&&(t=n.h-(n.lensH+2))),l.l=Math.round(o),l.t=Math.round(t),n.lensBgX=l.l+1,n.lensBgY=l.t+1,"inside"===n.mode?(n.largeL=Math.round(e*(n.zoom-n.lensW/n.w)),n.largeT=Math.round(a*(n.zoom-n.lensH/n.h))):(n.largeL=Math.round(n.lensBgX*n.zoom*(n.largeWrapperW/n.w)),n.largeT=Math.round(n.lensBgY*n.zoom*(n.largeWrapperH/n.h)))},x=function(e){var a=e.wheelDelta>0||e.detail<0?.1:-.1,t=n.onzoom,i=1,r=0,m=0;e.preventDefault&&e.preventDefault(),e.returnValue=!1,n.zoom=Math.round(10*(n.zoom+a))/10,n.zoom>=1.1?(n.lensW=Math.round(n.w/n.zoom),n.lensH=Math.round(n.h/n.zoom),"inside"===n.mode?(r=n.w,m=n.h):(r=n.largeWrapperW,m=n.largeWrapperH,i=n.largeWrapperW/n.w),n.largeW=Math.round(n.zoom*r),n.largeH=Math.round(n.zoom*m),z(),y(),null!==t&&t({thumb:o,lens:s,large:d,x:l.x,y:l.y,zoom:Math.round(n.zoom*i*10)/10,w:n.lensW,h:n.lensH})):n.zoom=1.1},M=function(){n=g[m],s=v("#"+m+"-lens"),2===n.status?(s.className="magnifier-lens",n.zoomAttached===!1&&(void 0!==n.zoomable&&n.zoomable===!0&&(e.attach("mousewheel",s,x),window.addEventListener&&s.addEventListener("DOMMouseScroll",function(e){x(e)})),n.zoomAttached=!0),d=v("#"+m+"-large"),d.className="magnifier-large"):1===n.status&&(s.className="magnifier-loader")},C=function(){if(n.status>0){var e=n.onthumbleave;null!==e&&e({thumb:o,lens:s,large:d,x:l.x,y:l.y}),-1===s.className.indexOf("hidden")&&(s.className+=" hidden",o.className=n.thumbCssClass,null!==d&&(d.className+=" hidden"))}},W=function(){if(r!==n.status&&M(),n.status>0){o.className=n.thumbCssClass+" opaque",1===n.status?s.className="magnifier-loader":2===n.status&&(s.className="magnifier-lens",d.className="magnifier-large",d.style.left="-"+n.largeL+"px",d.style.top="-"+n.largeT+"px"),s.style.left=l.l+"px",s.style.top=l.t+"px",s.style.backgroundPosition="-"+n.lensBgX+"px -"+n.lensBgY+"px";var e=n.onthumbmove;null!==e&&e({thumb:o,lens:s,large:d,x:l.x,y:l.y})}r=n.status},E=function(e,a){var t=e.getBoundingClientRect(),o=0,n=0;a.x=t.left,a.y=t.top,a.w=Math.round(t.right-a.x),a.h=Math.round(t.bottom-a.y),a.lensW=Math.round(a.w/a.zoom),a.lensH=Math.round(a.h/a.zoom),"inside"===a.mode?(o=a.w,n=a.h):(o=a.largeWrapperW,n=a.largeWrapperH),a.largeW=Math.round(a.zoom*o),a.largeH=Math.round(a.zoom*n)};this.attach=function(e){if(void 0===e.thumb)throw{name:"Magnifier error",message:"Please set thumbnail",toString:function(){return this.name+": "+this.message}};var a=v(e.thumb),t=0;if(void 0!==a.length)for(t;t<a.length;t+=1)e.thumb=a[t],this.set(e);else e.thumb=a,this.set(e)},this.setThumb=function(e){o=e},this.set=function(a){if(void 0!==g[a.thumb.id])return o=a.thumb,!1;var t=new Image,r=new Image,h=a.thumb,f=h.id,y=null,x=null,N=v("#"+a.largeWrapper)||v("#"+h.getAttribute("data-large-img-wrapper"))||v("#"+n.largeWrapperId),I=a.zoom||h.getAttribute("data-zoom")||u,k=a.mode||h.getAttribute("data-mode")||c,D=void 0!==a.onthumbenter?a.onthumbenter:n.onthumbenter,$=void 0!==a.onthumbleave?a.onthumbleave:n.onthumbleave,H=void 0!==a.onthumbmove?a.onthumbmove:n.onthumbmove,R=void 0!==a.onzoom?a.onzoom:n.onzoom;if(x=void 0===a.large?null!==a.thumb.getAttribute("data-large-img-url")?a.thumb.getAttribute("data-large-img-url"):a.thumb.src:a.large,null===N&&"inside"!==k)throw{name:"Magnifier error",message:"Please specify large image wrapper DOM element",toString:function(){return this.name+": "+this.message}};void 0!==a.zoomable?y=a.zoomable:null!==h.getAttribute("data-zoomable")?y="true"===h.getAttribute("data-zoomable"):void 0!==n.zoomable&&(y=n.zoomable),""===h.id&&(f=h.id="magnifier-item-"+i,i+=1),b(h,f),g[f]={zoom:I,mode:k,zoomable:y,thumbCssClass:h.className,zoomAttached:!1,status:0,largeUrl:x,largeWrapperId:"outside"===k?N.id:null,largeWrapperW:"outside"===k?N.offsetWidth:null,largeWrapperH:"outside"===k?N.offsetHeight:null,onzoom:R,onthumbenter:D,onthumbleave:$,onthumbmove:H},e.attach("mouseover",h,function(e,a){0!==n.status&&C(),m=a.id,o=a,M(a),E(o,n),l.x=e.clientX,l.y=e.clientY,z(),W();var t=n.onthumbenter;null!==t&&t({thumb:o,lens:s,large:d,x:l.x,y:l.y})},!1),e.attach("mousemove",h,function(){p=1}),e.attach("load",t,function(){g[f].status=1,E(h,g[f]),w(f),e.attach("load",r,function(){g[f].status=2,w(f,h,r,N)}),r.src=g[f].largeUrl}),t.src=h.src},e.attach("mousemove",document,function(e){l.x=e.clientX,l.y=e.clientY,z(),h===!0?W():(0!==p&&C(),p=0)},!1),e.attach("scroll",window,function(){null!==o&&E(o,n)})};angular.module("schemaForm").run(["$templateCache",function(e){e.put("directives/decorators/bootstrap/imagemodal/imagemodal.html",'<div class="form-group" ng-class="{\'has-error\': hasError()}"><label class="control-label">{{form.title}}</label>    <img        name="{{form.key}}"        class="form-control"        schema-validate="form"        ng-model="$$value$$"        image-modal        image-is-zoomable="form.enableZoom"        image-is-uploadable="form.enableUpload"        image-is-removable="form.enableRemove">    <span class="help-block">        {{ (hasError() && errorMessage(schemaError())) || form.description}}    </span></div>')}]).config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,a,t){var o=function(a,o,n){if("imagemodal"===o.type&&"image"===o.format){var l=e.stdFormObj(a,o,n);return l.key=n.path,l.type="imagemodal",n.lookup[t.stringify(n.path)]=l,l}};e.defaults.string.unshift(o),a.addMapping("bootstrapDecorator","imagemodal","directives/decorators/bootstrap/imagemodal/imagemodal.html"),a.createDirective("imagemodal","directives/decorators/bootstrap/imagemodal/imagemodal.html")}]),angular.module("schemaForm").run(["$templateCache",function(e){e.put("imagemodal.html",'<div   class="image-modal-wrapper"   ng-class="{       uploading:isUploading   }">   <img       ng-class="{clickable: !isUploadable}"       ng-show="hasImage"       ng-click="onImageClick(); $event.preventDefault()">   <input       ng-if="isUploadable"       accept="image/jpg, image/jpeg, image/png, image/gif, image/bmp"       type="file"       file-reader       on-file-change="onImageChange(files)">   <span class="img-upload-label" ng-show="!hasImage"></span>   <a       class="is-removable"       href=""       ng-if="isRemovable && hasImage"       ng-click="removeImage()">Remove</a></div>'),e.put("imagemodal-dialog.html",'<div   class="image-dialog">   <div class="image-dialog-vertical-center">       <div class="image-dialog-body">           <img               id="thumb"               class="md-card-image"               ng-src="{{imgSrc}}">       </div>       <a           href=""           title="Close"           class="close-btn"           ng-click="onCloseOnMask($event); $event.preventDefault()">           Close       </a>       <div class="button-holder">           <md-button               class="md-raised md-primary"               ng-click="onDoneClick(); $event.preventDefault()">               Done           </md-button>       </div>   </div></div>')}]).directive("fileReader",[function(){return{restrict:"A",scope:{onFileChange:"&",onFileChangeError:"&"},link:function(e,a){function t(t){t.length>0&&(e.onFileChange({files:t}),a.val(void 0),e.$apply())}a.on("change",function(e){t(e.target.files)}),a[0].ondrop=function(e){e.preventDefault&&e.preventDefault(),t(e.dataTransfer.files)},a[0].ondragenter=function(e){e.preventDefault(),e.stopPropagation()},a[0].ondragover=function(e){e.preventDefault(),e.stopPropagation()},a.attr("type","file")}}}]).directive("imageModal",["imageModalService",function(e){return{restrict:"A",requires:"ngModel",scope:{imageSrc:"=ngModel",isUploadable:"=imageIsUploadable",isRemovable:"=imageIsRemovable",isZoomable:"=imageIsZoomable"},templateUrl:"imagemodal.html",replace:!0,link:function(a,t,o){var n=(Date.now(),t.find("img")[0]),l=["image/jpg","image/jpeg","image/png","image/gif","image/bmp"],i=function(e){if(e){var t=new FileReader;t.readAsDataURL(e),t.onloadend=function(e){n.src=e.target.result},a.hasImage=!0}else a.imageSrc&&(n.src=a.imageSrc,a.hasImage=!0)},r=function(){var e=localStorage.getItem(o.id);e&&(a.imageSrc="null"!=e?e:null),a.imageSrc&&i()},m=function(e){localStorage.setItem(o.id,e)};a.onImageChange=function(t){var o=t[0];if(-1!=l.indexOf(o.type)){var i=new FileReader,r=new Image;i.readAsDataURL(o),i.onloadend=function(e){r.src=e.target.result},r.onload=function(){e.show({src:r.src,isZoomable:a.isZoomable}).then(function(e){n.src=e,a.isUploadable&&m(e),a.hasImage=!0})["catch"](function(e){console.log(e)})}}else alert("File type not supported")},a.onImageClick=function(){e.show({src:n.src,isZoomable:a.isZoomable}).then(function(){})["catch"](function(e){console.log(e)})},a.removeImage=function(){a.imageSrc=null,n.src="",a.hasImage=!1,localStorage.setItem(o.id,"null")},r()}}}]).factory("imageModalService",["$rootScope","$animate","$compile","$timeout","$templateCache","$http","$q",function(e,a,t,o,n,l,i){var r,m,s=e.$new(!0),d="imagemodal-dialog.html",u=function(e){var a=i.defer(),o=function(e){e?a.resolve(e):a.reject("ImageModal Canceled"),g()},n=function(){if(window.Magnifier&&window.Event){var e=new Event,a=new Magnifier(e);a.attach({thumb:"#thumb",large:s.imgSrc,mode:"inside",zoom:3,zoomable:!0})}};return s.imgSrc=s.options.src,m=t(e)(s),r||(r=document.getElementsByTagName("body")),r=angular.element(r),r.append(m),s.options.isZoomable&&setTimeout(function(){var e=document.getElementsByClassName("image-dialog-body");if(e&&e.length>0){var a=e[0],t=a.getElementsByTagName("img");t&&t.length>0&&(t=t[0],a.style.width=t.width+"px")}n()},0),s.onCloseOnMask=function(e){if(e&&e.target&&e.target.className){var t=e.target.className;"close-btn"==t&&(g(),a.reject("ImageModal Canceled"))}},s.onDoneClick=function(){o(s.options.src),g()},a.promise},c=function(e){var a=i.defer(),t=n.get(d);return s.options=e?e:new Object,t?u(t).then(function(e){a.resolve(e)})["catch"](function(e){a.reject(e)}):l.get(d).success(function(e){n.put(d,e),u(e).then(function(e){a.resolve(e)})["catch"](function(e){a.reject(e)})}),a.promise},g=function(){m&&a.leave(m,function(){m.remove()})};return{show:function(e){return c(e)},dismiss:function(){g()}}}]),angular.module("dangular",["ngMaterial","AppCtrl","schemaForm"]),angular.module("AppCtrl",[]).controller("AppCtrl",["$scope",function(e){e.model={enableRemove:!0,enableUpload:!0,enableZoom:!0},e.form=[{key:"profpic",type:"imagemodal",title:"Profile Pic",description:"My Face",format:"image",enableUpload:e.model.enableUpload,enableRemove:e.model.enableRemove,enableZoom:e.model.enableZoom},"enableRemove","enableUpload","enableZoom","name","email",{key:"comment",type:"textarea",placeholder:"Make a comment"},{type:"submit",style:"btn-info",title:"OK"}],e.schema={type:"object",title:"Comment",properties:{enableUpload:{type:"boolean",title:"Enable Upload"},enableRemove:{type:"boolean",title:"Enable Remove"},enableZoom:{type:"boolean",title:"Enable Zoom"},name:{title:"Name",type:"string"},email:{title:"Email",type:"string",pattern:"^\\S+@\\S+$",description:"Email will be used for evil."},comment:{title:"Comment",type:"string",maxLength:20,validationMessage:"Don't be greedy!"}},required:["name","email","comment"]},e.$watch("model",function(a){a&&(e.form[0].enableRemove=a.enableRemove,e.form[0].enableUpload=a.enableUpload,e.form[0].enableZoom=a.enableZoom)},!0)}]);